<!--除数据外都完整-->
<!DOCTYPE html>
<html>
<head>
    
    <title>class</title>
    <style>
        html{
            height: 100%;
            overflow:hidden;
            font-weight:100;
        }
        body {
            font-family: 'Roboto', sans-serif;
            font-size: 1em;
            height: 100%;
            margin: 0;
        }
        
        .content{
            float: left;
            width: 100%;
            height: 50%;
            z-index: 10;
            border-bottom:1px #000000 solid;
        }

        .list-item {
            display: inline-block;
            box-sizing: content-box;
            margin: 0;
            padding: 0;
            box-shadow: 1px 2px 4px 0px rgba(0,0,0,0.25);
            width:24.8%;
            height: 50vh;
			}
        .left{
            float: left;
            border-right:1px #000000 solid;
        }
        .right{
            float: right;
            border-left:1px #000000 solid;
        }

        #canvas-frame {
            position:absolute;
            /*top:10vh;*/
            left:12.5vw;
            width: 75vw;
            height: 99vh;
            z-index: 5;
        }
    </style>
    
</head>
<body>
    <div id="canvas-frame"></div>
    <!-- <div class="content">
        <div class="list-item left"></div>
        <div class="list-item left" id="g1"></div>
        <div class="list-item left" id="g2"></div>
        <div class="list-item option" id="g3"></div>
    </div>
    <div class="content">
        <div class="list-item left"></div>
        <div class="list-item left" id="g4"></div>
        <div class="list-item left" id="g5"></div>
        <div class="list-item nextCanvas" id="g6"></div>
    </div> -->

    <script src="./static/js/support/three.js" ></script>
    
    <script src="./static/js/support/OrbitControls.js" ></script>
    
    <script src="./static/js/support/STLLoader.js" ></script>

    <script src="./static/js/objSelection.js"></script>

    <script src="static/js/support/d3.v4.min.js"></script>
    
    <script type="text/javascript">
        class GraphThree{
            static scenes;
            scene;
            renderer;

            group;
            threeDiv;//dom对象
            data;//存放几何体数据，name, length, color
            object_selection;

            // #FFCF71 10%, #2376DD
            //d3.color('#5fc3e4'), d3.color('#e55d87')
            color = d3.interpolate(d3.color('#FFCF71'), d3.color('#2376DD'));//颜色插值函数，网页背景色
            isCatalog = false;

            constructor(data, renderDivId, isCatalog) {//对象和两个字符串
                this.isCatalog = isCatalog;
                this.threeDiv = document.getElementById( renderDivId );
                this.renderer = new THREE.WebGLRenderer( {antialias: true, alpha: true} );
                this.renderer.setClearColor( 0xffffff, 0 );

                var width = this.threeDiv.clientWidth;
                var height = this.threeDiv.clientHeight;
                this.renderer.setSize(width, height);
                this.threeDiv.appendChild(this.renderer.domElement);

                // GraphThree.scenes = new Array();
                this.scene = new THREE.Scene();
                // GraphThree.scenes.push(this.scene);

                this.group = new THREE.Object3D();
                this.scene.add(this.group);

                this.scene.userData.element = document.getElementById(renderDivId);

                var camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 10000);
                camera.position.x = 0;
                camera.position.y = 100;
                camera.position.z = 300;
                camera.lookAt(this.group.position);
                this.scene.add(camera);
                this.scene.userData.camera = camera;

                var light = new THREE.DirectionalLight(0xffffff, 1.0, 0);
                light.position.set(-100, 500, 200);
                this.scene.add(light);

                // var aLight = new THREE.AmbientLight( 0xaaaaaa ); // soft white light
                // this.scene.add( aLight );

                var orbitControls = new THREE.OrbitControls(this.scene.userData.camera, this.scene.userData.element);
                orbitControls.target = this.group.position;//控制焦点
                orbitControls.autoRotate = true;//自动旋转
                this.scene.userData.controls = orbitControls;

                this.data = data;
            }

            initGrid(){
                //平面
                var gridXZ = new THREE.GridHelper(200, 10, 0xa23131, 0xa23131);//4个参数分别是：网格宽度、等分数、中心线颜色，网格线颜色
                gridXZ.position.set( 0,0,0 );
                gridXZ.material.linewidth = 2;
                this.scene.add(gridXZ);
                if(this.isCatalog){
                    gridXZ.scale.set(0.6, 0.6, 0.6)
                }
            }
        }

        class Model extends GraphThree{
            constructor(data, threeDivId, isCatalog){
                super(data, threeDivId, isCatalog);
                var light2 = new THREE.DirectionalLight(0xeeeeee, 1.0, 0);
                light2.position.set(500, 0, 0);
                this.scene.add(light2);

                var light3 = new THREE.DirectionalLight(0xeeeeee, 1.0, 0);
                light3.position.set(-500, 0, 0);
                this.scene.add(light3);
            }

            start(){
                // this.initGrid();
                // this.creatAureole();
                this.initObject();
                
                // this.ObjectSelection();
                this.render();
            }

            render() {
                this.scene.userData.controls.update();

                // if(this.isCatalog == false){
                //     this.object_selection.render(this.group, this.scene.userData.camera);
                // }

                this.renderer.render(this.scene, this.scene.userData.camera);
                requestAnimationFrame(this.render.bind(this));//传递当前语境中的this
            }

            initObject(){
                var loader = new THREE.STLLoader();
                var material = new THREE.MeshPhongMaterial( { color: 0xffffff, specular: 0x111111, shininess: 200 } );


                // Colored binary STL
                loader.load( './static/model/stl/binary/hand1.stl', 
                    function ( geometry ) {

                        var meshMaterial = material;
                        if ( geometry.hasColors ) {

                            meshMaterial = new THREE.MeshPhongMaterial( { opacity: geometry.alpha, vertexColors: THREE.VertexColors } );

                        }

                        geometry.center();

                        var mesh = new THREE.Mesh( geometry, meshMaterial );

                        scene.userData.controls.target = mesh.position;//控制焦点
            

                        mesh.rotation.set( - Math.PI / 2, 0, 0 );
                        // mesh.scale.set( 0.5, 0.5, 0.5 );

                        mesh.castShadow = true;
                        mesh.receiveShadow = true;

                        // scene.add( mesh );
                        group.add(mesh);
                    }
                );
            }


            ObjectSelection(){
                this.object_selection = new THREE.ObjectSelection({//个人封装的js，three.js官方库中无
                    domElement: this.scene.userData.element,//渲染区域
                    selected: function(selectObj) {//selectObj为选取返回对象
                        if(selectObj !== null) {//判断是否为空，objsel.js中有对应
                            
                      } else {
                        
                      }
                    },
                    clicked: function(selectObj) {//点击事件
                        // obj.material.color.setHex( Math.random() * 0xe0e0e0 );
                    },
                    mousedown: function(selectObj) {//点击事件
                        // obj.material.color.setHex( Math.random() * 0xe0e0e0 );
                    },
                    mouseup: function(selectObj) {//点击事件
                        // obj.material.color.setHex( Math.random() * 0xe0e0e0 );
                    }
                  });
            }

        }

    </script>

    <script>
    var isCatalog = true;

    var hand = new Model('./static/model/stl/binary/hand1.stl', 'canvas-frame', isCatalog);
    hand.start();
    // hand.group.scale.set(0.7, 0.7, 0.7);

    </script>


</body>
</html>